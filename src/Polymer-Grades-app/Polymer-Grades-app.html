<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/font-roboto/roboto.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="Polymer-Grades-app">
  <template>
    <style include="iron-flex">
      :host {
        display: block;
        font-family: 'Roboto';
        background-color: #fff;
      }
      :host.dark {
        background-color: #F4F4F4;
      }
      .square {
        margin-top: 10vh;
        width: 90vw;
        max-width: 500px;
        height: 90vw;
        max-height: 500px;
        background-color: #2196F3;
      }
      .smallSquare {
        width: 100%;
        background-color: #2196F3;
        display: block;
      }
      .text {
        margin-top: 16px;
        font-size: 36px;
      }
      #login {
        max-width: 300px;
        width: 80vw;
        margin-top: 20vh;
        padding: 16px;
        display: block;
        border-radius: 4px;
        background-color: #fff;

      }
      iron-pages {
        min-height: 100vh;
      }
      .loginPageIcon {
        padding-top: 20px;
        margin-right: 9px;
      }
      paper-button {
        display: block;
        margin-top: 8px;
        background: #2196F3;
        color: white;
      }
      paper-input {
        width: 85%;
      }
      paper-progress {
        margin-top: 16px;
        width: 95%;
        margin-left: 2.5%;
        --paper-progress-active-color: var(--paper-light-blue-500);
      }
      .hidden {
        display: none;
        opacity: 0;
      }
      #loginErrorText {
        margin-left: 8px;
      }
    </style>
    <div>
      <iron-pages attr-for-selected="id" selected="home" class="vertical center layout">

        <div class="" id="home" on-tap="_showInput">
          <div class="square"></div>
          <div class="text">Sebastian Boyd</div>
        </div>

        <div id="login" class="vertical center layout">
          <div class="smallSquare"></div>
          <div class="horizontal center layout">
            <iron-icon icon="icons:account-circle" class="loginPageIcon"></iron-icon>
            <paper-input value="{{usrInput}}" label="Username"></paper-input>
          </div>
          <div class="horizontal center layout">
            <iron-icon icon="icons:lock" class="loginPageIcon"></iron-icon>
            <paper-input value="{{pwInput}}" type="password" on-keypress="_keyPressed" label="Password"></paper-input>
          </div>
          <paper-button raised on-tap="_login">Login</paper-button>
          <paper-progress indeterminate class="hidden"></paper-progress>
          <div style="margin-top:16px; margin-left:8px;color:red;" class="horizontal center layout hidden" id="errorContainer">
            <iron-icon icon="icons:error"></iron-icon>
            <div id="loginErrorText">Login Error</div>
          </div>
        </div>

        <div>

        </div>
        <div>Three</div>
      </iron-pages>
    </div>

  </template>

  <script>
    Polymer({

      is: 'Polymer-Grades-app',

      properties: {
        prop1: {
          type: String,
          value: 'Polymer-Grades-app',
        },
      },

      _showInput: function() {
        var pages = document.querySelector('iron-pages');
        pages.select('login');
        this.classList.add('dark');
      },

      _login: function() {
        var prog = document.querySelector('paper-progress');
        var err = document.getElementById('errorContainer');
        prog.classList.remove('hidden');
        err.classList.add('hidden')
        var http = new XMLHttpRequest();
        var url = "https://powerful-depths-26532.herokuapp.com/login";
        var params = "login=" + this.usrInput + "&password=" + this.pwInput;
        http.open("POST", url, true);
        http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        http.onreadystatechange = function() {//Call a function when the state changes.
            if(http.readyState == 4) {
              if (http.status == 200) {
                this.classData = http.responseText;
                console.log(http.responseText);
                prog.classList.add('hidden');
              }
              else {
                console.log(http.status);
                prog.classList.add('hidden');
                err.classList.remove('hidden')

              }
            }
        }
        http.send(params);
      },
      _keyPressed: function(e) {
        if (13 === e.charCode) {
            this._login();
        }
    },

    });
  </script>
</dom-module>
